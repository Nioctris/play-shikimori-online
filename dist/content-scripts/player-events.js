if (window.parent) {
  /** @type {HTMLVideoElement} */
  const video = document.querySelector('video#main-video_html5_api');

  if (video) {
    const events = ["abort", "canplay", "canplaythrough", "durationchange", "emptied", "ended", "error", "loadeddata", "loadedmetadata", "loadstart", "pause", "play", "playing", "progress", "ratechange", "seeked ", "seeking", "stalled", "suspend", "timeupdate", "volumechange", "waiting"];
    events.forEach(eventName => {
      video.addEventListener(eventName, (event) => {
        const currentTime = video.currentTime;
        const duration = video.duration;
        const paused = video.paused;

        window.parent.postMessage({
          name: eventName,
          currentTime,
          duration,
          paused,
        }, '*');


        if (eventName === 'timeupdate') {
          /** @type {HTMLButtonElement} */
          let nextEpisodeButton = document.querySelector('.next-episode');

          if (duration - currentTime < 120) {
            if (!nextEpisodeButton) {
              nextEpisodeButton = document.createElement('button');
              nextEpisodeButton.innerText = "Следующий епизод";
              nextEpisodeButton.classList.add('next-episode');
              nextEpisodeButton.hidden = true;
              document.querySelector('#main-video').appendChild(nextEpisodeButton);

              nextEpisodeButton.onclick = function () {
                window.parent.postMessage({
                  name: 'mark-as-watched',
                  currentTime: video.currentTime,
                  duration: video.duration,
                  paused: video.paused,
                }, '*');
              };
            }

            nextEpisodeButton.hidden = false;
          } else if (nextEpisodeButton) {
            nextEpisodeButton.hidden = true;
          }
        }
      });
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLWV2ZW50cy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbnRlbnQtc2NyaXB0cy9wbGF5ZXItZXZlbnRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImlmICh3aW5kb3cucGFyZW50KSB7XG4gIC8qKiBAdHlwZSB7SFRNTFZpZGVvRWxlbWVudH0gKi9cbiAgY29uc3QgdmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd2aWRlbyNtYWluLXZpZGVvX2h0bWw1X2FwaScpXG5cbiAgaWYgKHZpZGVvKSB7XG4gICAgY29uc3QgZXZlbnRzID0gW1wiYWJvcnRcIiwgXCJjYW5wbGF5XCIsIFwiY2FucGxheXRocm91Z2hcIiwgXCJkdXJhdGlvbmNoYW5nZVwiLCBcImVtcHRpZWRcIiwgXCJlbmRlZFwiLCBcImVycm9yXCIsIFwibG9hZGVkZGF0YVwiLCBcImxvYWRlZG1ldGFkYXRhXCIsIFwibG9hZHN0YXJ0XCIsIFwicGF1c2VcIiwgXCJwbGF5XCIsIFwicGxheWluZ1wiLCBcInByb2dyZXNzXCIsIFwicmF0ZWNoYW5nZVwiLCBcInNlZWtlZCBcIiwgXCJzZWVraW5nXCIsIFwic3RhbGxlZFwiLCBcInN1c3BlbmRcIiwgXCJ0aW1ldXBkYXRlXCIsIFwidm9sdW1lY2hhbmdlXCIsIFwid2FpdGluZ1wiXVxuICAgIGV2ZW50cy5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgKGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gdmlkZW8uY3VycmVudFRpbWVcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSB2aWRlby5kdXJhdGlvblxuICAgICAgICBjb25zdCBwYXVzZWQgPSB2aWRlby5wYXVzZWRcblxuICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICBuYW1lOiBldmVudE5hbWUsXG4gICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgcGF1c2VkLFxuICAgICAgICB9LCAnKicpXG5cblxuICAgICAgICBpZiAoZXZlbnROYW1lID09PSAndGltZXVwZGF0ZScpIHtcbiAgICAgICAgICAvKiogQHR5cGUge0hUTUxCdXR0b25FbGVtZW50fSAqL1xuICAgICAgICAgIGxldCBuZXh0RXBpc29kZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXh0LWVwaXNvZGUnKVxuXG4gICAgICAgICAgaWYgKGR1cmF0aW9uIC0gY3VycmVudFRpbWUgPCAxMjApIHtcbiAgICAgICAgICAgIGlmICghbmV4dEVwaXNvZGVCdXR0b24pIHtcbiAgICAgICAgICAgICAgbmV4dEVwaXNvZGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgICAgICAgICAgICBuZXh0RXBpc29kZUJ1dHRvbi5pbm5lclRleHQgPSBcItCh0LvQtdC00YPRjtGJ0LjQuSDQtdC/0LjQt9C+0LRcIlxuICAgICAgICAgICAgICBuZXh0RXBpc29kZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCduZXh0LWVwaXNvZGUnKVxuICAgICAgICAgICAgICBuZXh0RXBpc29kZUJ1dHRvbi5oaWRkZW4gPSB0cnVlXG4gICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtYWluLXZpZGVvJykuYXBwZW5kQ2hpbGQobmV4dEVwaXNvZGVCdXR0b24pXG5cbiAgICAgICAgICAgICAgbmV4dEVwaXNvZGVCdXR0b24ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgIG5hbWU6ICdtYXJrLWFzLXdhdGNoZWQnLFxuICAgICAgICAgICAgICAgICAgY3VycmVudFRpbWU6IHZpZGVvLmN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHZpZGVvLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgcGF1c2VkOiB2aWRlby5wYXVzZWQsXG4gICAgICAgICAgICAgICAgfSwgJyonKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5leHRFcGlzb2RlQnV0dG9uLmhpZGRlbiA9IGZhbHNlXG4gICAgICAgICAgfSBlbHNlIGlmIChuZXh0RXBpc29kZUJ1dHRvbikge1xuICAgICAgICAgICAgbmV4dEVwaXNvZGVCdXR0b24uaGlkZGVuID0gdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSlcbiAgfVxufSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUU7O0VBRWpCLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsNEJBQTRCLEVBQUM7O0VBRWxFLElBQUksS0FBSyxFQUFFO0lBQ1QsTUFBTSxNQUFNLEdBQUcsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUM7SUFDNVIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLElBQUk7TUFDMUIsS0FBSyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQUssS0FBSztRQUMzQyxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsWUFBVztRQUNyQyxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsU0FBUTtRQUMvQixNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsT0FBTTs7UUFFM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7VUFDeEIsSUFBSSxFQUFFLFNBQVM7VUFDZixXQUFXO1VBQ1gsUUFBUTtVQUNSLE1BQU07U0FDUCxFQUFFLEdBQUcsRUFBQzs7O1FBR1AsSUFBSSxTQUFTLEtBQUssWUFBWSxFQUFFOztVQUU5QixJQUFJLGlCQUFpQixHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsZUFBZSxFQUFDOztVQUUvRCxJQUFJLFFBQVEsR0FBRyxXQUFXLEdBQUcsR0FBRyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtjQUN0QixpQkFBaUIsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBQztjQUNwRCxpQkFBaUIsQ0FBQyxTQUFTLEdBQUcsbUJBQWtCO2NBQ2hELGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFDO2NBQy9DLGlCQUFpQixDQUFDLE1BQU0sR0FBRyxLQUFJO2NBQy9CLFFBQVEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxDQUFDLGlCQUFpQixFQUFDOztjQUVwRSxpQkFBaUIsQ0FBQyxPQUFPLEdBQUcsWUFBWTtnQkFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7a0JBQ3hCLElBQUksRUFBRSxpQkFBaUI7a0JBQ3ZCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztrQkFDOUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2tCQUN4QixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07aUJBQ3JCLEVBQUUsR0FBRyxFQUFDO2dCQUNSO2FBQ0Y7O1lBRUQsaUJBQWlCLENBQUMsTUFBTSxHQUFHLE1BQUs7V0FDakMsTUFBTSxJQUFJLGlCQUFpQixFQUFFO1lBQzVCLGlCQUFpQixDQUFDLE1BQU0sR0FBRyxLQUFJO1dBQ2hDO1NBQ0Y7T0FDRixDQUFDLENBQUM7S0FDSixFQUFDO0dBQ0g7In0=
